# 4장 이미지 갤러리 최적화

### 레이아웃 이동 피하기

- 레이아웃 이동이란 화면상의 요소 변화로 레이아웃이 갑자기 밀리는 현상을 말함. 이미지 갤러리 서비스를 새로고침해보면 레이아웃 이동 현상을 볼 수 있다. 이때 이미지가 로드될 때 아래 이미지보다 늦게 로드될 때 아래 이미지보다 늦게 로드되는 경우, 뒤늦게 아래 이미지를 밀어내면서 화면에 그려짐.

- 이때 CLS지표에 영향을 줄 수있음.

> CLS란?
>
> 웹 페이지에 레이아웃 이동이 얼마나 발생하는지를 나타내는 지표로 Cumulative Layout Shift의 약자이다.

- 레이아웃이 이동의 원인

  - 사이즈가 미리 정의되지 않은 이미지 요소
  - 사이즈가 미리 정의되지 않은 광고 요소
  - 동적으로 삽입된 콘텐츠
  - 웹폰트(FOIT, FOUT)

- 레이아웃 이동 해결
  -> 레이아웃 이동을 일으키는 요소의 사이즈를 지정하면 됨.
  - padding을 이용하여 box를 만든 뒤, 그 안에 이미지를 absolute로 띄우는 방식
    - but 매번 padding의 퍼센트를 매번 계산해야하고 코드가 직관적이지 않음.
      => aspect-ratio CSS 속성 활용하기

### 이미지 지연로딩

- 이미지가 지연로드 될때 아쉬운점
  - 초기 화면의 리소스는 절약할 수 있으나, 스크롤을 내려 화면에 이미지가 들어올 때 이미지를 로드하기 때문에 처음에 이미지가 보이지 않고 시간이 지나야 이미지가 보인다는 점.
  - 이 문제를 해결하기 위해서 이미지가 화면에 들어오는 시점보다 조금 더 미리 이미지를 불러와 화면에 들어온 시점부터 이미지가 준비되어 있도록 해야함.

### 리덕스 렌더링 최적화

- 리액트는 렌더링의 사이클을 갖는데 상태가 변경될때 마다 리렌더링 과정을 거침.

- 현재 실습서비스 내 발생하는 문제
  - 이미지를 클릭하여 모달창을 띄울 시 모달만 렌더링되지 않고 모달과 전혀 상관이 없는 헤더와 이미지 리스트 컴포넌트까지 리렌더링되고 있음.
    - redux 떄문임
    - 이미지 리스트와 헤더의 카테고리, 그리고 모달에 관한 장보는 리덕스에서 관리함.
    - 컴포넌트들은 이 리덕스 상태를 구독하여 상태가 변했을 때를 감지하고 리렌더링함.
    - useSelector는 서로 다른 상태를 참조할 때 리렌더링 하지 않도록 구현되어있으나 반환 값이 이전 값과 같으면 해당 컴포넌트는 리덕스 상태 변화에 영향이 없다고 판단하여 리렌더링 하지 않고, 반환 값이 이전값과 다르면 영향이 있다고 판단하여 리렌더링하게 됨.

### 병목 코드 분석하기

- 메모이제이션으로 코드 최적화하기
  - 메모이제이션의 단점
    - 두번쨰 실행부터는 성능이 대폭 향상되나 첫번째는 여전히 느림.
    - 그래서 메모이제이션을 적용할 때는 해당 로직이 동일한 조건에서 충분히 반복 실행되는지 먼저 체크해야함.
